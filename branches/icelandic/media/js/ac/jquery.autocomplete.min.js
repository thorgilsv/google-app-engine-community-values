/*
Autocomplete 1.0.2
Copyright (c) 2007 Dylan Verheul, Dan G. Switzer, Anjesh Tuladhar, JÃ¶rn Zaefferer
Dual licensed under the MIT and GPL licenses:
*/;;(function(f){f.fn.extend({autocomplete:function(b,c){var h=typeof b=="string";c=f.extend({},f.Autocompleter.defaults,{url:h?b:null,data:h?null:b,delay:h?f.Autocompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(a){return a};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new f.Autocompleter(this,c)})},result:function(a){return this.bind("result",a)},search:function(a){return this.trigger("search",[a])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(a){return this.trigger("setOptions",[a])},unautocomplete:function(){return this.trigger("unautocomplete")}});f.Autocompleter=function(l,d){var e={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var i=f(l).attr("autocomplete","off").addClass(d.inputClass);var p;var q="";var m=f.Autocompleter.Cache(d);var j=0;var s;var t={mouseDownOnSelect:false};var k=f.Autocompleter.Select(d,l,w,t);var v;f.browser.opera&&f(l.form).bind("submit.autocomplete",function(){if(v){v=false;return false}});i.bind((f.browser.opera?"keypress":"keydown")+".autocomplete",function(a){s=a.keyCode;switch(a.keyCode){case e.UP:a.preventDefault();if(k.visible()){k.prev()}else{u(0,true)}break;case e.DOWN:a.preventDefault();if(k.visible()){k.next()}else{u(0,true)}break;case e.PAGEUP:a.preventDefault();if(k.visible()){k.pageUp()}else{u(0,true)}break;case e.PAGEDOWN:a.preventDefault();if(k.visible()){k.pageDown()}else{u(0,true)}break;case d.multiple&&f.trim(d.multipleSeparator)==","&&e.COMMA:case e.TAB:case e.RETURN:if(w()){a.preventDefault();v=true;return false}break;case e.ESC:k.hide();break;default:clearTimeout(p);p=setTimeout(u,d.delay);break}}).focus(function(){j++}).blur(function(){j=0;if(!t.mouseDownOnSelect){C()}}).click(function(){if(j++>1&&!k.visible()){u(0,true)}}).bind("search",function(){var g=(arguments.length>1)?arguments[1]:null;function n(a,b){var c;if(b&&b.length){for(var h=0;h<b.length;h++){if(b[h].result.toLowerCase()==a.toLowerCase()){c=b[h];break}}}if(typeof g=="function")g(c);else i.trigger("result",c&&[c.data,c.value])}f.each(x(i.val()),function(a,b){B(b,n,n)})}).bind("flushCache",function(){m.flush()}).bind("setOptions",function(){f.extend(d,arguments[1]);if("data"in arguments[1])m.populate()}).bind("unautocomplete",function(){k.unbind();i.unbind();f(l.form).unbind(".autocomplete")});function w(){var a=k.selected();if(!a)return false;var b=a.result;q=b;if(d.multiple){var c=x(i.val());if(c.length>1){b=c.slice(0,c.length-1).join(d.multipleSeparator)+d.multipleSeparator+b}b+=d.multipleSeparator}i.val(b);y();i.trigger("result",[a.data,a.value]);return true}function u(a,b){if(s==e.DEL){k.hide();return}var c=i.val();if(!b&&c==q)return;q=c;c=z(c);if(c.length>=d.minChars){i.addClass(d.loadingClass);if(!d.matchCase)c=c.toLowerCase();B(c,D,y)}else{A();k.hide()}};function x(c){if(!c){return[""]}var h=c.split(d.multipleSeparator);var g=[];f.each(h,function(a,b){if(f.trim(b))g[a]=f.trim(b)});return g}function z(a){if(!d.multiple)return a;var b=x(a);return b[b.length-1]}function E(a,b){if(d.autoFill&&(z(i.val()).toLowerCase()==a.toLowerCase())&&s!=e.BACKSPACE){i.val(i.val()+b.substring(z(q).length));f.Autocompleter.Selection(l,q.length,q.length+b.length)}};function C(){clearTimeout(p);p=setTimeout(y,200)};function y(){var c=k.visible();k.hide();clearTimeout(p);A();if(d.mustMatch){i.search(function(a){if(!a){if(d.multiple){var b=x(i.val()).slice(0,-1);i.val(b.join(d.multipleSeparator)+(b.length?d.multipleSeparator:""))}else i.val("")}})}if(c)f.Autocompleter.Selection(l,l.value.length,l.value.length)};function D(a,b){if(b&&b.length&&j){A();k.display(b,a);E(a,b[0].value);k.show()}else{y()}};function B(c,h,g){if(!d.matchCase)c=c.toLowerCase();var n=m.load(c);if(n&&n.length){h(c,n)}else if((typeof d.url=="string")&&(d.url.length>0)){var o={timestamp:+new Date()};f.each(d.extraParams,function(a,b){o[a]=typeof b=="function"?b():b});var r=f.extend({},o);r[d.qParam||'q']=z(c);r[d.limitParam||'limit']=d.max;f.ajax({mode:"abort",port:"autocomplete"+l.name,dataType:d.dataType,url:d.url,data:r,success:function(a){var b=d.parse&&d.parse(a)||F(a);m.add(c,b);h(c,b)}})}else{k.emptyList();g(c)}};function F(a){var b=[];var c=a.split("\n");for(var h=0;h<c.length;h++){var g=f.trim(c[h]);if(g){g=g.split("|");b[b.length]={data:g,value:g[0],result:d.formatResult&&d.formatResult(g,g[0])||g[0]}}}return b};function A(){i.removeClass(d.loadingClass)}};f.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(a){return a[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:", ",highlight:function(a,b){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");},scroll:true,scrollHeight:180};f.Autocompleter.Cache=function(e){var i={};var p=0;function q(a,b){if(!e.matchCase)a=a.toLowerCase();var c=a.indexOf(b);if(c==-1)return false;return c==0||e.matchContains;};function m(a,b){if(p>e.cacheLength){s();}if(!i[a]){p++;}i[a]=b;}function j(){if(!e.data)return false;var c={},h=0;if(!e.url)e.cacheLength=1;c[""]=[];for(var g=0,n=e.data.length;g<n;g++){var o=e.data[g];o=(typeof o=="string")?[o]:o;var r=e.formatMatch(o,g+1,e.data.length);if(r===false)continue;var l=r.charAt(0).toLowerCase();if(!c[l])c[l]=[];var d={value:r,data:o,result:e.formatResult&&e.formatResult(o)||r};c[l].push(d);if(h++<e.max){c[""].push(d);}};f.each(c,function(a,b){e.cacheLength++;m(a,b);});}setTimeout(j,25);function s(){i={};p=0;}return{flush:s,add:m,populate:j,load:function(c){if(!e.cacheLength||!p)return null;if(!e.url&&e.matchContains){var h=[];for(var g in i){if(g.length>0){var n=i[g];f.each(n,function(a,b){if(q(b.value,c)){h.push(b);}});}}return h;}else if(i[c]){return i[c];}else if(e.matchSubset){for(var o=c.length-1;o>=e.minChars;o--){var n=i[c.substr(0,o)];if(n){var h=[];f.each(n,function(a,b){if(q(b.value,c)){h[h.length]=b;}});return h;}}}return null;}};};f.Autocompleter.Select=function(g,n,o,r){var l={ACTIVE:"ac_over"};var d,e=-1,i,p="",q=true,m,j;function s(){if(!q)return;m=f("<div/>").hide().addClass(g.resultsClass).css("position","absolute").appendTo(document.body);j=f("<ul/>").appendTo(m).mouseover(function(a){if(t(a).nodeName&&t(a).nodeName.toUpperCase()=='LI'){e=f("li",j).removeClass(l.ACTIVE).index(t(a));f(t(a)).addClass(l.ACTIVE);}}).click(function(a){f(t(a)).addClass(l.ACTIVE);o();n.focus();return false;}).mousedown(function(){r.mouseDownOnSelect=true;}).mouseup(function(){r.mouseDownOnSelect=false;});if(g.width>0)m.css("width",g.width);q=false;}function t(a){var b=a.target;while(b&&b.tagName!="LI")b=b.parentNode;if(!b)return[];return b;}function k(a){d.slice(e,e+1).removeClass(l.ACTIVE);v(a);var b=d.slice(e,e+1).addClass(l.ACTIVE);if(g.scroll){var c=0;d.slice(0,e).each(function(){c+=this.offsetHeight;});if((c+b[0].offsetHeight-j.scrollTop())>j[0].clientHeight){j.scrollTop(c+b[0].offsetHeight-j.innerHeight());}else if(c<j.scrollTop()){j.scrollTop(c);}}};function v(a){e+=a;if(e<0){e=d.size()-1;}else if(e>=d.size()){e=0;}}function w(a){return g.max&&g.max<a?g.max:a;}function u(){j.empty();var a=w(i.length);for(var b=0;b<a;b++){if(!i[b])continue;var c=g.formatItem(i[b].data,b+1,a,i[b].value,p);if(c===false)continue;var h=f("<li/>").html(g.highlight(c,p)).addClass(b%2==0?"ac_even":"ac_odd").appendTo(j)[0];f.data(h,"ac_data",i[b]);}d=j.find("li");if(g.selectFirst){d.slice(0,1).addClass(l.ACTIVE);e=0;}if(f.fn.bgiframe)j.bgiframe();}return{display:function(a,b){s();i=a;p=b;u();},next:function(){k(1);},prev:function(){k(-1);},pageUp:function(){if(e!=0&&e-8<0){k(-e);}else{k(-8);}},pageDown:function(){if(e!=d.size()-1&&e+8>d.size()){k(d.size()-1-e);}else{k(8);}},hide:function(){m&&m.hide();d&&d.removeClass(l.ACTIVE);e=-1;},visible:function(){return m&&m.is(":visible");},current:function(){return this.visible()&&(d.filter("."+l.ACTIVE)[0]||g.selectFirst&&d[0]);},show:function(){var a=f(n).offset();m.css({width:typeof g.width=="string"||g.width>0?g.width:f(n).width(),top:a.top+n.offsetHeight,left:a.left}).show();if(g.scroll){j.scrollTop(0);j.css({maxHeight:g.scrollHeight,overflow:'auto'});if(f.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var b=0;d.each(function(){b+=this.offsetHeight;});var c=b>g.scrollHeight;j.css('height',c?g.scrollHeight:b);if(!c){d.width(j.width()-parseInt(d.css("padding-left"))-parseInt(d.css("padding-right")));}}}},selected:function(){var a=d&&d.filter("."+l.ACTIVE).removeClass(l.ACTIVE);return a&&a.length&&f.data(a[0],"ac_data");},emptyList:function(){j&&j.empty();},unbind:function(){m&&m.remove();}};};f.Autocompleter.Selection=function(a,b,c){if(a.createTextRange){var h=a.createTextRange();h.collapse(true);h.moveStart("character",b);h.moveEnd("character",c);h.select()}else if(a.setSelectionRange){a.setSelectionRange(b,c)}else{if(a.selectionStart){a.selectionStart=b;a.selectionEnd=c}}a.focus()}})(jQuery);